"use strict";var app=angular.module("knurldApp",["ui.router","ui.grid","ngAnimate","ui.grid.pagination","ngDialog","ui.grid.resizeColumns","toaster","ui.grid.selection","angular-loading-bar","angularAudioRecorder","ngCookies"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.when("/dashboard","/dashboard/app_model"),n.otherwise("/login"),e.state("base",{"abstract":!0,url:"",templateUrl:"views/base.html"}).state("login",{url:"/login",parent:"base",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("consumer_login",{url:"/consumer_login",parent:"base",templateUrl:"views/consumer_login.html",controller:"ConsumerLoginCtrl"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"views/dashboard.html",controller:"DashboardCtrl",data:{requireLogin:!0}}).state("app_model",{url:"/app_model",parent:"dashboard",templateUrl:"views/dashboard/app_model.html",controller:"appModelController"}).state("consumer",{url:"/consumer",parent:"dashboard",templateUrl:"views/dashboard/consumer.html",controller:"consumerController"}).state("enrollment",{url:"/enrollment",parent:"dashboard",templateUrl:"views/dashboard/enrollment.html",controller:"enrollmentController"}).state("verification",{url:"/verification",parent:"dashboard",templateUrl:"views/dashboard/verification.html",controller:"verificationController"}).state("calls",{url:"/calls",parent:"dashboard",templateUrl:"views/dashboard/calls.html",controller:"callsController"}).state("analytics",{url:"/analytics",parent:"dashboard",controller:"analyticsController",templateUrl:"views/dashboard/analytics.html"})}]).factory("Auth",function(){return{isLoggedIn:!1}});app.config(["ngDialogProvider",function(e){e.setDefaults({className:"ngdialog-theme-default",plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,appendTo:!1})}]),app.filter("range",function(){return function(e,n,t){n=parseInt(n),t=parseInt(t);for(var l=n;t>l;l++)e.push(l);return e}}),app.run(["$rootScope","ngDialog",function(e,n){e.$on("$routeChangeStart",function(e,t){n.close()}),e.$on("$stateChangeStart",function(e,t){n.close()})}]),app.run(["$rootScope","$state","$location","Auth","$window",function(e,n,t,l,r){e.$on("$stateChangeStart",function(e,t,s,o){var a=void 0!==t.data&&t.data.requireLogin&&!l.isLoggedIn,i=r.sessionStorage.getItem("ACCESS_TOKEN");if(l.isLoggedIn){var d=""===o.name&&"dashboard"!==t.name;return void(d&&(n.go("dashboard"),e.preventDefault()))}if(""!=i&&null!=i){var u="https://api.knurld.io/";KnurldSDK.init(),KnurldSDK.setHostUrl(u),KnurldSDK.setAccessToken(i),KnurldSDK.setDevID(r.sessionStorage.getItem("DEV_ID")),KnurldSDK.setConsumerDevID(r.sessionStorage.getItem("CONSUMER_DEV_ID")),"CONSUMER"==r.sessionStorage.getItem("USER")?KnurldSDK.setConsumer(!0):KnurldSDK.setConsumer(!1),a=!1}else a=!0;return a&&"login"!=t.name&&"consumer_login"!=t.name?(n.go("login"),void e.preventDefault()):void 0})}]),app.service("knurldAPI",function(){var e="https://api.knurld.io/";KnurldSDK.init(),KnurldSDK.setHostUrl(e)}),app.service("errorHandlingService",function(){this.proccess=function(e,n,t,l){NProgress.done();var r=e.message;if(angular.isUndefined(r)){var s=e.fault;if(angular.isUndefined(s)){if(!angular.isUndefined(e.StatusCode)){var o=e.StatusCode;return void(0==o?l.error("Knurld","Unknown error"):l.error(n,"Invalid status code for API:"+o))}}else{var a=s.faultstring;if("Access Token expired"==a)return l.error("Knurld","Auth token expired please login again"),void t.go("login");if("Invalid Auth Token"==a)return l.error("Knurld","Invalid Developer-Id"),void t.go("login");r=a}}return"Invalid Auth Token"==r?(l.error("Knurld","Invalid Developer-Id"),void t.go("login")):void l.error(n,r)}}),app.service("words",function(){var e=["Atlanta","Baltimore","Boston","Chicago","Cleveland","Dallas","Denver","Memphis","Nashville","Orlando","Phoenix","Seattle"],n=["Athens","London","Paris","Toronto","Berlin","Madrid"],t=["England","Brazil","Mexico","Japan","Germany","Turkey","Canada","Sweden"],l=["Olive","Amber","Orange","Yellow","Purple","Maroon","Ivory","Crimson"],r=["Octagon","Diamond","Arrow","Triangle","Circle","Pyramid","Oval","Cylinder"];this.getUSCities=function(){return e},this.getGlobalCities=function(){return n},this.getGlobalConutries=function(){return t},this.getColors=function(){return l},this.getShapes=function(){return r}}),app.service("constant",function(){var e=!1,n=!0,t=600,l='<div ng-class="grid.options.rowStyle(row)"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.uid" ui-grid-one-bind-id-grid="rowRenderIndex + \'-\' + col.uid + \'-cell\'" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader}" class="ui-grid-cell" role="{{col.isRowHeader ? \'rowheader\' : \'gridcell\'}}" ui-grid-cell></div></div>',r=!1,s="app_model",o="consumer",a="/",i="post",d="get",u="delete";this.getAppModel=function(){return s},this.getConsumer=function(){return o},this.getSepr=function(){return a},this.getPost=function(){return i},this.getGet=function(){return d},this.getDelete=function(){return u},this.isAddAndUpdateEnrollmentClicked=function(){return e},this.setAddAndUpdateEnrollmentClicked=function(n){e=n},this.isAdJust600MiliGap=function(){return n},this.setAdJust600MiliGap=function(e){n=e},this.getMilisRequired=function(){return t},this.setMilisRequired=function(e){t=e},this.getTemplate=function(){return l},this.isCustomerLoggedIn=function(){return r},this.setCustomerLoggedIn=function(e){r=e}});var KnurldSDK=KnurldSDK||{};KnurldSDK.init=function(e){var n={};return n.initialized=!0,KnurldSDKUtil.isValidObj(e)&&"host"in e&&KnurldSDK.setHostUrl(e.host),n},KnurldSDK.setHostUrl=function(e){KnurldConstants.HOST=e,KnurldSDKUtil.setupURL()},KnurldSDK.getHostUrl=function(){return KnurldConstants.HOST},KnurldSDK.setConsumer=function(e){KnurldConstants.IS_CONSUMER=e},KnurldSDK.isConsumer=function(){return KnurldConstants.IS_CONSUMER},KnurldSDK.uploadFile=function(e,n,t,l){var r={},s=KnurldSDKUtil.getAPIParams(r,t,l);return KnurldSDKUtil.isValidObj(e)?(s.contentType=KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA,s.requestType=KnurldConstants.POST,KnurldHttpRequest.uploadFile(e,n,s)):KnurldResponse.invalidInputResponse("invalid inputs",s)},KnurldSDK.clearInterval=function(e){KnurldSDKUtil.isValidObj(e)&&clearInterval(e)},KnurldSDK.setDevID=function(e){KnurldConstants.DEV_ID=e},KnurldSDK.getDevID=function(){return KnurldConstants.DEV_ID},KnurldSDK.setConsumerDevID=function(e){KnurldConstants.CONSUMER_DEV_ID=e},KnurldSDK.getConsumerDevID=function(){return KnurldConstants.CONSUMER_DEV_ID},KnurldSDK.setAccessToken=function(e){KnurldConstants.ACCESS_TOKEN=e},KnurldSDK.getAccessToken=function(){return KnurldConstants.ACCESS_TOKEN},KnurldSDK.auth=function(){return{accesstoken:function(e,n,t,l){var r=e.isTimer;if(KnurldSDKUtil.isValidObj(r)&&r){var s=KnurldConstants.LOGIN_TIMER;KnurldSDKUtil.isValidObj(s)&&(s=KnurldConstants.GLOBAL_TIMER),setInterval(function(){KnurldAuthImpl.accesstoken(e,KnurldSDKUtil.commonCallBack,KnurldSDKUtil.commonCallBack,l)},s)}return KnurldAuthImpl.accesstoken(e,n,t,l)},status:function(e,n,t){return KnurldAuthImpl.status(e,n,t)}}}(""),KnurldSDK.appModel=function(){return{create:function(e,n,t,l){return KnurldAppModelImpl.post(e,n,t,l)},update:function(e,n,t,l){return KnurldAppModelImpl.post(e,n,t,l)},get:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldAppModelImpl.get(e,n,t)},o)}else r=KnurldAppModelImpl.get(e,n,t,l);return r},getAll:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldAppModelImpl.getAll(e,n,t)},o)}else r=KnurldAppModelImpl.getAll(e,n,t,l);return r},getAllInOneCall:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER_FOR_GET_ALL_CALL),r=setInterval(function(){KnurldAppModelImpl.getAll(e,n,t)},o)}else r=KnurldAppModelImpl.getAllInOneCall(e,n,t,l);return r},del:function(e,n,t,l){return KnurldAppModelImpl.del(e,n,t,l)}}}(""),KnurldSDK.consumer=function(){return{create:function(e,n,t,l){return KnurldConsumerImpl.post(e,n,t,l)},update:function(e,n,t,l){return KnurldConsumerImpl.post(e,n,t,l)},get:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldConsumerImpl.get(e,n,t)},o)}else r=KnurldConsumerImpl.get(e,n,t,l);return r},getAll:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldConsumerImpl.getAll(e,n,t)},o)}else r=KnurldConsumerImpl.getAll(e,n,t,l);return r},getAllInOneCall:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER_FOR_GET_ALL_CALL),r=setInterval(function(){KnurldAppModelImpl.getAll(e,n,t)},o)}else r=KnurldConsumerImpl.getAllInOneCall(e,n,t,l);return r},del:function(e,n,t,l){return KnurldConsumerImpl.del(e,n,t,l)},token:function(e,n,t,l){return KnurldConsumerImpl.token(e,n,t,l)}}}(""),KnurldSDK.enrollment=function(){return{create:function(e,n,t,l){return KnurldEnrollmentImpl.post(e,n,t,l)},update:function(e,n,t,l){return KnurldEnrollmentImpl.post(e,n,t,l)},postWithFile:function(e,n,t,l){return KnurldEnrollmentImpl.postWithFile(e,n,t,l)},createAndUpdate:function(e,n,t,l){return KnurldEnrollmentImpl.createAndPost(e,n,t,l)},get:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldEnrollmentImpl.get(e,n,t)},o)}else r=KnurldEnrollmentImpl.get(e,n,t,l);return r},getAll:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldEnrollmentImpl.getAll(e,n,t)},o)}else r=KnurldEnrollmentImpl.getAll(e,n,t,l);return r},del:function(e,n,t,l){return KnurldEnrollmentImpl.del(e,n,t,l)}}}(""),KnurldSDK.verification=function(){return{create:function(e,n,t,l){return KnurldVerificationImpl.post(e,n,t,l)},update:function(e,n,t,l){return KnurldVerificationImpl.post(e,n,t,l)},get:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldVerificationImpl.get(e,n,t)},o)}else r=KnurldVerificationImpl.get(e,n,t,l);return r},getAll:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldVerificationImpl.getAll(e,n,t)},o)}else r=KnurldVerificationImpl.getAll(e,n,t,l);return r},del:function(e,n,t,l){return KnurldVerificationImpl.del(e,n,t,l)}}}(""),KnurldSDK.call=function(){return{create:function(e,n,t,l){return KnurldCallImpl.post(e,n,t,l)},update:function(e,n,t,l){return KnurldCallImpl.post(e,n,t,l)},get:function(e,n,t,l){return KnurldCallImpl.get(e,n,t,l)},del:function(e,n,t,l){return KnurldCallImpl.del(e,n,t,l)}}}(""),KnurldSDK.analytics=function(){return{file:function(e,n,t,l){return KnurldAnalysisImpl.file(e,n,t,l)},get:function(e,n,t,l){var r,s=e.isTimer;if(KnurldSDKUtil.isValidObj(s)&&s){var o=e.interval;KnurldSDKUtil.isValidObj(o)&&(o=KnurldConstants.GLOBAL_TIMER),r=setInterval(function(){KnurldAnalysisImpl.get(e,n,t)},o)}else r=KnurldAnalysisImpl.get(e,n,t,l);return r},url:function(e,n,t,l){return KnurldAnalysisImpl.url(e,n,t,l)}}}("");var KnurldConstants=KnurldConstants||{};KnurldConstants.HOST,KnurldConstants.POST="POST",KnurldConstants.GET="GET",KnurldConstants.PUT="PUT",KnurldConstants.DELETE="DELETE",KnurldConstants.CONSUMER="consumer",KnurldConstants.APPLICATION="app-models",KnurldConstants.URL_SEPR="/",KnurldConstants.V1="v1/",KnurldConstants.APP_URL,KnurldConstants.GLOBAL_TIMER=2e3,KnurldConstants.CONSUMER_URL,KnurldConstants.ACCESS_TOKEN="",KnurldConstants.DEV_ID,KnurldConstants.CONSUMER_DEV_ID,KnurldConstants.ISV1=!0,KnurldConstants.CONTENT_TYPE_APPLICATION_JSON="application/json",KnurldConstants.CONTENT_TYPE_FORM_ENCODED_URL="application/x-www-form-urlencoded",KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA="multipart/form-data",KnurldConstants.FETCH_ALL_OFFSET=50,KnurldConstants.LOGIN_TIMER=162e6,KnurldConstants.GLOBAL_TIMER_FOR_GET_ALL_CALL=18e6,KnurldConstants.IS_CONSUMER=!1,KnurldConstants.ENDPOINT_LOGIN="oauth/client_credential/accesstoken?grant_type=client_credentials",KnurldConstants.ENDPOINT_STATUS="status",KnurldConstants.INVALID_INPUT="invalid inputs",KnurldConstants.CLIENT_ID="client_id",KnurldConstants.CLIENT_SECRET="client_secret",KnurldConstants.ID="id";var KnurldAnalysisImpl=KnurldAnalysisImpl||{};KnurldAnalysisImpl.get=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);if(!KnurldSDKUtil.isValidObj(e.id))return KnurldResponse.invalidInputResponse("id",r);var s=KnurldSDKUtil.buildUrl("endpointAnalysis/"+e.id,KnurldConstants.ISV1);return KnurldHttpRequest.sendRequest(s,null,r)},KnurldAnalysisImpl.file=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);var s={};KnurldSDKUtil.isValidObj(e.num_words)&&(s.num_words=e.num_words),s.fileData=e.fileData,r.requestType=KnurldConstants.POST;var o=KnurldSDKUtil.buildUrl("endpointAnalysis/file",KnurldConstants.ISV1);return r.contentType=KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA,KnurldHttpRequest.sendRequest(o,s,r)},KnurldAnalysisImpl.url=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);if(!KnurldSDKUtil.isEmpty(e.audioUrl))return KnurldResponse.invalidInputResponse("audioUrl",r);var s={};KnurldSDKUtil.isValidObj(e.num_words)&&(s.num_words=e.num_words),s.audioUrl=e.audioUrl,r.requestType=KnurldConstants.POST;var o=KnurldSDKUtil.buildUrl("endpointAnalysis/url",KnurldConstants.ISV1);return KnurldHttpRequest.sendRequest(o,s,r)};var KnurldAppModelImpl=KnurldAppModelImpl||{};KnurldAppModelImpl.post=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);if(!KnurldSDKUtil.isValidObj(e.enrollmentRepeats))return KnurldResponse.invalidInputResponse("enrollmentRepeats",r);if(!KnurldSDKUtil.isValidObj(e.verificationLength))return KnurldResponse.invalidInputResponse("verificationLength",r);var s;r.requestType=KnurldConstants.POST;var o={};if(o.enrollmentRepeats=e.enrollmentRepeats,o.verificationLength=e.verificationLength,o.vocabulary=e.vocabulary,KnurldSDKUtil.isValidObj(e.appModelId)){if(!KnurldSDKUtil.isValidObj(e.threshold))return KnurldResponse.invalidInputResponse("threshold",r);o.threshold=e.threshold,s=KnurldSDKUtil.buildUrl("app-models/"+e.appModelId,KnurldConstants.ISV1)}else{if(s=KnurldSDKUtil.buildUrl("app-models",KnurldConstants.ISV1),!KnurldSDKUtil.isValidObj(e.vocabulary))return KnurldResponse.invalidInputResponse("vocabulary",r);o.enrollmentRepeats=e.enrollmentRepeats,KnurldSDKUtil.isValidObj(e.threshold)&&(o.threshold=e.threshold),KnurldSDKUtil.isValidObj(e.autoThresholdEnable)&&(o.autoThresholdEnable=e.autoThresholdEnable),KnurldSDKUtil.isValidObj(e.autoThresholdClearance)&&(o.autoThresholdClearance=e.autoThresholdClearance),KnurldSDKUtil.isValidObj(e.autoThresholdMaxRise)&&(o.autoThresholdMaxRise=e.autoThresholdMaxRise),KnurldSDKUtil.isValidObj(e.useModelUpdate)&&(o.useModelUpdate=e.useModelUpdate),KnurldSDKUtil.isValidObj(e.modelUpdateDailyLimit)&&(o.modelUpdateDailyLimit=e.modelUpdateDailyLimit)}return KnurldHttpRequest.sendRequest(s,o,r)},KnurldAppModelImpl.get=function(e,n,t,l){var r,s=KnurldSDKUtil.getAPIParams(l,n,t),o={};return KnurldSDKUtil.isValidObj(e.appModelId)?r=KnurldSDKUtil.buildUrl("app-models/"+e.appModelId,KnurldConstants.ISV1):(KnurldSDKUtil.isValidObj(e.limit)&&(o.limit=e.limit),KnurldSDKUtil.isValidObj(e.offset)&&(o.offset=e.offset),r=KnurldSDKUtil.buildUrl("app-models",KnurldConstants.ISV1)),KnurldHttpRequest.sendRequest(r,o,s)},KnurldAppModelImpl.getAllInOneCall=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t),s={};s.limit=1e3,s.offset=0;var o=KnurldSDKUtil.buildUrl("app-models",KnurldConstants.ISV1);return KnurldHttpRequest.sendRequest(o,s,r)},KnurldAppModelImpl.getAll=function(e,n,t,l){var l={},r=[],s=0;KnurldAppModelImpl.get(e,function(e){if(KnurldSDKUtil.isValidObj(e))if(e.length<=10)n(e);else{var t=e.items;for(var o in t)r[r.length]=t[o];for(i=10;i<e.total;i+=KnurldConstants.FETCH_ALL_OFFSET){var a={};a.limit=KnurldConstants.FETCH_ALL_OFFSET,a.offset=i,KnurldAppModelImpl.get(a,function(e){var t=e.items;for(var l in t)r[r.length]=t[l];r.length>=e.total-s*KnurldConstants.FETCH_ALL_OFFSET&&n(r)},function(e){console.log(e),s++},l)}}},function(e){t(e)},l)},KnurldAppModelImpl.del=function(e,n,t,l){if(!KnurldSDKUtil.isValidObj(e.appModelId))return KnurldResponse.invalidInputResponse("modelId",r);var r=KnurldSDKUtil.getAPIParams(l,n,t),s=KnurldSDKUtil.buildUrl("app-models/"+e.appModelId,KnurldConstants.ISV1);return r.requestType=KnurldConstants.DELETE,KnurldHttpRequest.sendRequest(s,null,r)};var KnurldAuthImpl=KnurldAuthImpl||{};KnurldAuthImpl.accesstoken=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(r.localSuccessHandler=KnurldAuthImpl.catchAccessTokenSuccessCallBack,!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);if(!KnurldSDKUtil.isEmpty(e.client_id))return KnurldResponse.invalidInputResponse(KnurldConstants.CLIENT_ID,r);if(!KnurldSDKUtil.isEmpty(e.client_secret))return KnurldResponse.invalidInputResponse(KnurldConstants.CLIENT_SECRET,r);KnurldSDKUtil.isValidObj(e.developer_id)&&(KnurldConstants.DEV_ID=devId);var s=KnurldSDKUtil.buildUrl(KnurldConstants.ENDPOINT_LOGIN,!KnurldConstants.ISV1);r.requestType=KnurldConstants.POST;var o={};return o.client_id=e.client_id,o.client_secret=e.client_secret,r.sendAccessToken=!1,r.sendDevID=!1,r.contentType=KnurldConstants.CONTENT_TYPE_FORM_ENCODED_URL,KnurldHttpRequest.sendRequest(s,o,r)},KnurldAuthImpl.catchAccessTokenSuccessCallBack=function(e,n){KnurldConstants.ACCESS_TOKEN=e.access_token,n(e)},KnurldAuthImpl.status=function(e,n,t){var l=KnurldSDKUtil.getAPIParams(t,e,n),r=KnurldSDKUtil.buildUrl(KnurldConstants.ENDPOINT_STATUS,KnurldConstants.ISV1);return KnurldHttpRequest.sendRequest(r,null,l)};var KnurldCallImpl=KnurldCallImpl||{};KnurldCallImpl.post=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);var s;r.requestType=KnurldConstants.POST;var o={};if(o.number=e.number,KnurldSDKUtil.isValidObj(e.callId))s=KnurldSDKUtil.buildUrl("calls/"+e.callId,KnurldConstants.ISV1);else{if(!KnurldSDKUtil.isEmpty(e.number))return KnurldResponse.invalidInputResponse("number",r);s=KnurldSDKUtil.buildUrl("calls",KnurldConstants.ISV1)}return KnurldHttpRequest.sendRequest(s,o,r)},KnurldCallImpl.get=function(e,n,t,l){var r,s={},o=KnurldSDKUtil.getAPIParams(l,n,t);return KnurldSDKUtil.isValidObj(e.callId)?r=KnurldSDKUtil.buildUrl("calls/"+e.callId,KnurldConstants.ISV1):(r=KnurldSDKUtil.buildUrl("calls",KnurldConstants.ISV1),KnurldSDKUtil.isValidObj(e.limit)&&(s.limit=e.limit),KnurldSDKUtil.isValidObj(e.offset)&&(s.offset=e.offset)),KnurldHttpRequest.sendRequest(r,s,o)},KnurldCallImpl.del=function(e,n,t,l){if(!KnurldSDKUtil.isValidObj(e.callId))return KnurldResponse.invalidInputResponse("callId",r);var r=KnurldSDKUtil.getAPIParams(l,n,t),s=KnurldSDKUtil.buildUrl("calls/"+e.callId,KnurldConstants.ISV1);return r.requestType=KnurldConstants.DELETE,KnurldHttpRequest.sendRequest(s,null,r)};var KnurldConsumerImpl=KnurldConsumerImpl||{};KnurldConsumerImpl.post=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);if(!KnurldSDKUtil.isValidObj(e.password))return KnurldResponse.invalidInputResponse("password",r);var s;r.requestType=KnurldConstants.POST;var o={};if(o.password=e.password,KnurldSDKUtil.isValidObj(e.consumerId))s=KnurldSDKUtil.buildUrl("consumers/"+e.consumerId,KnurldConstants.ISV1);else{if(s=KnurldSDKUtil.buildUrl("consumers",KnurldConstants.ISV1),!KnurldSDKUtil.isEmpty(e.Gender))return KnurldResponse.invalidInputResponse("Gender",r);if(!KnurldSDKUtil.isValidObj(e.username))return KnurldResponse.invalidInputResponse("username",r);o.gender=e.Gender,o.username=e.username}return KnurldHttpRequest.sendRequest(s,o,r)},KnurldConsumerImpl.get=function(e,n,t,l){var r,s={},o=KnurldSDKUtil.getAPIParams(l,n,t);return KnurldSDKUtil.isValidObj(e.consumerId)?r=KnurldSDKUtil.buildUrl("consumers/"+e.consumerId,KnurldConstants.ISV1):(r=KnurldSDKUtil.buildUrl("consumers",KnurldConstants.ISV1),KnurldSDKUtil.isValidObj(e.limit)&&(s.limit=e.limit),KnurldSDKUtil.isValidObj(e.offset)&&(s.offset=e.offset)),KnurldHttpRequest.sendRequest(r,s,o)},KnurldConsumerImpl.getAll=function(e,n,t,l){var l={},r=[],s=0;KnurldConsumerImpl.get(e,function(e){if(KnurldSDKUtil.isValidObj(e))if(e.length<=10)n(e);else{var t=e.items;for(var o in t)r[r.length]=t[o];for(i=10;i<e.total;i+=KnurldConstants.FETCH_ALL_OFFSET){var a={};a.limit=KnurldConstants.FETCH_ALL_OFFSET,a.offset=i,KnurldConsumerImpl.get(a,function(e){var t=e.items;for(var l in t)r[r.length]=t[l];r.length>=e.total-s*KnurldConstants.FETCH_ALL_OFFSET&&n(r)},function(e){console.log(e),s++},l)}}},function(e){t(e)},l)},KnurldConsumerImpl.getAllInOneCall=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t),s={};s.limit=1e3,s.offset=0;var o=KnurldSDKUtil.buildUrl("consumers",KnurldConstants.ISV1);return KnurldHttpRequest.sendRequest(o,s,r)},KnurldConsumerImpl.del=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e.consumerId))return KnurldResponse.invalidInputResponse("consumerId",r);var s=KnurldSDKUtil.buildUrl("consumers/"+e.consumerId,KnurldConstants.ISV1);return r.requestType=KnurldConstants.DELETE,KnurldHttpRequest.sendRequest(s,null,r)},KnurldConsumerImpl.token=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(r.forceAdmin=!0,r.localSuccessHandler=KnurldConsumerImpl.catchAccessTokenSuccessCallBack,!KnurldSDKUtil.isValidObj(e.username))return KnurldResponse.invalidInputResponse("username",r);if(!KnurldSDKUtil.isValidObj(e.password))return KnurldResponse.invalidInputResponse("password",r);var s=KnurldSDKUtil.buildUrl("consumers/token",KnurldConstants.ISV1),o={};return r.requestType=KnurldConstants.POST,o.username=e.username,o.password=e.password,KnurldHttpRequest.sendRequest(s,o,r)},KnurldConsumerImpl.catchAccessTokenSuccessCallBack=function(e,n){KnurldSDK.setConsumerDevID("Bearer: "+e.token),n(e)};var KnurldEnrollmentImpl=KnurldEnrollmentImpl||{};KnurldEnrollmentImpl.post=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);var s;r.requestType=KnurldConstants.POST;var o={};if(KnurldSDKUtil.isValidObj(e.enrollmentId)){if(s=KnurldSDKUtil.buildUrl("enrollments/"+e.enrollmentId,KnurldConstants.ISV1),!KnurldSDKUtil.isValidObj(e.enrollmentUrl))return KnurldResponse.invalidInputResponse("enrollmentUrl",r);if(!KnurldSDKUtil.isValidObj(e.intervals))return KnurldResponse.invalidInputResponse("intervals",r);o["enrollment.wav"]=e.enrollmentUrl,o.intervals=e.intervals}else{if(!KnurldSDKUtil.isEmpty(e.consumerId))return KnurldResponse.invalidInputResponse("consumerId",r);if(!KnurldSDKUtil.isEmpty(e.applicationId))return KnurldResponse.invalidInputResponse("applicationId",r);s=KnurldSDKUtil.buildUrl("enrollments",KnurldConstants.ISV1),o.application=KnurldSDKUtil.buildApplicationIdUrl(e.applicationId),o.consumer=KnurldSDKUtil.buildConsumerIdUrl(e.consumerId)}return KnurldHttpRequest.sendRequest(s,o,r)},KnurldEnrollmentImpl.createAndPost=function(e,n,t,l){var r={},s=KnurldSDKUtil.getAPIParams(l,function(r){var s=KnurldSDKUtil.getAPIParams(l,n,t);s.requestType=KnurldConstants.POST;var a={};if(o=r.href,!KnurldSDKUtil.isValidObj(e.enrollmentUrl))return KnurldResponse.invalidInputResponse("enrollmentUrl",s);if(KnurldSDKUtil.isValidObj(e.intervals))KnurldEnrollmentImpl.executeEnroll(o,e,a,s);else if(KnurldSDKUtil.isValidObj(e.vocabulary)&&KnurldSDKUtil.isValidObj(e.enrollmentRepeats))KnurldEnrollmentImpl.addIntervals(o,e,a,s,t);else{var i={};i.appModelId=e.applicationId,KnurldAppModelImpl.get(i,function(n){e.enrollmentRepeats=n.enrollmentRepeats,e.vocabulary=n.vocabulary,KnurldEnrollmentImpl.addIntervals(o,e,a,s,t)},t)}},t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,s);if(!KnurldSDKUtil.isEmpty(e.consumerId))return KnurldResponse.invalidInputResponse("consumerId",s);if(!KnurldSDKUtil.isEmpty(e.applicationId))return KnurldResponse.invalidInputResponse("applicationId",s);if(!KnurldSDKUtil.isValidObj(e.enrollmentUrl))return KnurldResponse.invalidInputResponse("enrollmentUrl",s);var o=KnurldSDKUtil.buildUrl("enrollments",KnurldConstants.ISV1);r.application=KnurldSDKUtil.buildApplicationIdUrl(e.applicationId),r.consumer=KnurldSDKUtil.buildConsumerIdUrl(e.consumerId),s.requestType=KnurldConstants.POST,KnurldHttpRequest.sendRequest(o,r,s)},KnurldEnrollmentImpl.executeEnroll=function(e,n,t,l){return KnurldSDKUtil.isValidObj(n.intervals)?(t["enrollment.wav"]=n.enrollmentUrl,t.intervals=n.intervals,void KnurldHttpRequest.sendRequest(e,t,l)):KnurldResponse.invalidInputResponse("intervals",l)},KnurldEnrollmentImpl.addIntervals=function(e,n,t,l,r){var s={};s.audioUrl=n.enrollmentUrl;for(var o=new Array(0),a=0;a<n.vocabulary.length;a++)for(var i=0;i<n.enrollmentRepeats;i++)o.push(n.vocabulary[a]);KnurldEnrollmentImpl.executeUpload(e,n,s,t,l,o,r)},KnurldEnrollmentImpl.executeUpload=function(e,n,t,l,r,s,o){KnurldSDK.analytics.url(t,function(t){var a=(t.taskName,{});a.isTimer=!0,a.interval=100,a.id=t.taskName;var i=KnurldSDK.analytics.get(a,function(t){if("completed"==t.taskStatus){var a=t.intervals,d=0;angular.isUndefined(s)||angular.forEach(a,function(e,t){var l=Math.floor(d/n.enrollmentRepeats);angular.isUndefined(l)||(e.phrase=s[l]),d++})}else o("invalid audio please upload new one");KnurldSDK.clearInterval(i),n.intervals=a,KnurldEnrollmentImpl.executeEnroll(e,n,l,r)},o)})},KnurldEnrollmentImpl.postWithFile=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);r.contentType=KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA,r.requestType=KnurldConstants.POST;var s={},o=KnurldSDKUtil.buildUrl("enrollments/"+e.enrollmentId,KnurldConstants.ISV1);return s["enrollment.wav"]=e["enrollment.wav"],s.name="1.wav",KnurldHttpRequest.uploadFile(o,s,r)},KnurldEnrollmentImpl.get=function(e,n,t,l){var r,s={},o=KnurldSDKUtil.getAPIParams(l,n,t);return KnurldSDKUtil.isValidObj(e.enrollmentId)?r=KnurldSDKUtil.buildUrl("enrollments/"+e.enrollmentId,KnurldConstants.ISV1):(r=KnurldSDKUtil.buildUrl("enrollments",KnurldConstants.ISV1),KnurldSDKUtil.isValidObj(e.limit)&&(s.limit=e.limit),KnurldSDKUtil.isValidObj(e.offset)&&(s.offset=e.offset)),KnurldHttpRequest.sendRequest(r,s,o)},KnurldEnrollmentImpl.getAll=function(e,n,t,l){var l={},r=[],s=0;KnurldEnrollmentImpl.get(e,function(e){if(KnurldSDKUtil.isValidObj(e))if(e.length<=10)n(e);else{var t=e.items;for(var o in t)r[r.length]=t[o];for(i=10;i<e.total;i+=KnurldConstants.FETCH_ALL_OFFSET){var a={};a.limit=KnurldConstants.FETCH_ALL_OFFSET,a.offset=i,KnurldEnrollmentImpl.get(a,function(e){var t=e.items;for(var l in t)r[r.length]=t[l];r.length>=e.total-s*KnurldConstants.FETCH_ALL_OFFSET&&n(r)},function(e){console.log(e),s++},l)}}},function(e){t(e)},l)},KnurldEnrollmentImpl.del=function(e,n,t,l){if(!KnurldSDKUtil.isValidObj(e.enrollmentId))return KnurldResponse.invalidInputResponse("enrollmentId",r);var r=KnurldSDKUtil.getAPIParams(l,n,t),s=KnurldSDKUtil.buildUrl("enrollments/"+e.enrollmentId,KnurldConstants.ISV1);return r.requestType=KnurldConstants.DELETE,KnurldHttpRequest.sendRequest(s,null,r)};var KnurldVerificationImpl=KnurldVerificationImpl||{};KnurldVerificationImpl.post=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isValidObj(e))return KnurldResponse.invalidInputResponse(KnurldConstants.INVALID_INPUT,r);var s;r.requestType=KnurldConstants.POST;var o={};if(KnurldSDKUtil.isValidObj(e.verificationId)){if(s=KnurldSDKUtil.buildUrl("verifications/"+e.verificationId,KnurldConstants.ISV1),!KnurldSDKUtil.isValidObj(e.verificationUrl))return KnurldResponse.invalidInputResponse("verificationUrl",r);if(o["verification.wav"]=e.verificationUrl,o.intervals=e.intervals,!KnurldSDKUtil.isValidObj(e.intervals))return KnurldSDKUtil.isValidObj(e.phrases)?void KnurldVerificationImpl.addIntervals(s,e,o,r,t):KnurldResponse.invalidInputResponse("phrases",r)}else{if(!KnurldSDKUtil.isValidObj(e.applicationId))return KnurldResponse.invalidInputResponse("applicationId",r);if(!KnurldSDKUtil.isValidObj(e.consumerId))return KnurldResponse.invalidInputResponse("consumerId",r);s=KnurldSDKUtil.buildUrl("verifications",KnurldConstants.ISV1),o.application=KnurldSDKUtil.buildApplicationIdUrl(e.applicationId),o.consumer=KnurldSDKUtil.buildConsumerIdUrl(e.consumerId)}return KnurldHttpRequest.sendRequest(s,o,r)},KnurldVerificationImpl.addIntervals=function(e,n,t,l,r){var s={};s.audioUrl=n.verificationUrl,KnurldSDK.analytics.url(s,function(s){var o=(s.taskName,{});o.isTimer=!0,o.interval=100,o.id=s.taskName;var a=KnurldSDK.analytics.get(o,function(s){if("completed"==s.taskStatus){var o=s.intervals,i=0;angular.forEach(o,function(e,t){angular.isUndefined(i)||(e.phrase=n.phrases[i]),i++})}else r("invalid audio please upload new one");return KnurldSDK.clearInterval(a),t.intervals=o,KnurldHttpRequest.sendRequest(e,t,l)},r)})},KnurldVerificationImpl.get=function(e,n,t,l){var r,s={},o=KnurldSDKUtil.getAPIParams(l,n,t);return KnurldSDKUtil.isValidObj(e.verificationId)?r=KnurldSDKUtil.buildUrl("verifications/"+e.verificationId,KnurldConstants.ISV1):(KnurldSDKUtil.isValidObj(e.limit)&&(s.limit=e.limit),KnurldSDKUtil.isValidObj(e.offset)&&(s.offset=e.offset),r=KnurldSDKUtil.buildUrl("verifications",KnurldConstants.ISV1)),KnurldHttpRequest.sendRequest(r,s,o)},KnurldVerificationImpl.getAll=function(e,n,t,l){var l={},r=[],s=0;KnurldVerificationImpl.get(e,function(e){if(KnurldSDKUtil.isValidObj(e))if(e.length<=10)n(e);else{var t=e.items;for(var o in t)r[r.length]=t[o];for(i=10;i<e.total;i+=KnurldConstants.FETCH_ALL_OFFSET){var a={};a.limit=KnurldConstants.FETCH_ALL_OFFSET,a.offset=i,KnurldVerificationImpl.get(a,function(e){var t=e.items;for(var l in t)r[r.length]=t[l];r.length>=e.total-s*KnurldConstants.FETCH_ALL_OFFSET&&n(r)},function(e){console.log(e),s++},l)}}},function(e){t(e)},l)},KnurldVerificationImpl.del=function(e,n,t,l){var r=KnurldSDKUtil.getAPIParams(l,n,t);if(!KnurldSDKUtil.isEmpty(e.verificationId))return KnurldResponse.invalidInputResponse("verificationId",r);var s=KnurldSDKUtil.buildUrl("verifications/"+e.verificationId,KnurldConstants.ISV1);return r.requestType=KnurldConstants.DELETE,KnurldHttpRequest.sendRequest(s,null,r)};var KnurldResponse=KnurldResponse||{};KnurldResponse.invalidInputResponse=function(e,n){var t={};return t.StatusCode=400,t.errorMessage="input param:"+e+" is missing",n.asyc?t:void n.errorCallBack(t)};var KnurldHttpRequest=KnurldHttpRequest||{};KnurldHttpRequest.sendRequest=function(url,bodyParams,configParams){
var httpRequest=new XMLHttpRequest,urlEncodedData="",urlEncodedDataPairs=[];if(!httpRequest)return alert("Giving up :( Cannot create an XMLHTTP instance"),!1;if(null!=bodyParams)if(KnurldConstants.CONTENT_TYPE_FORM_ENCODED_URL==configParams.contentType||KnurldConstants.GET==configParams.requestType){for(name in bodyParams)urlEncodedDataPairs.push(encodeURIComponent(name)+"="+encodeURIComponent(bodyParams[name]));urlEncodedData=urlEncodedDataPairs.join("&").replace(/%20/g,"+")}else if(KnurldConstants.CONTENT_TYPE_APPLICATION_JSON==configParams.contentType){var jsonObj={};for(name in bodyParams)jsonObj[name]=bodyParams[name];urlEncodedData=JSON.stringify(jsonObj)}else if(KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA==configParams.contentType){urlEncodedData=new FormData;for(name in bodyParams)urlEncodedData.append(name,bodyParams[name])}return httpRequest.onreadystatechange=function(){var response={};return httpRequest.readyState==XMLHttpRequest.DONE&&configParams.async?4==httpRequest.readyState&&(200===httpRequest.status||201===httpRequest.status||202===httpRequest.status)||KnurldConstants.DELETE==configParams.requestType&&204===httpRequest.status?(response=httpRequest.responseText,""!=response&&-1!=response.indexOf("{")&&(response=eval("("+response+")")),void 0!=configParams.localSuccessHandler?configParams.localSuccessHandler(response,configParams.successCallBack):configParams.successCallBack(response),response):(response=httpRequest.responseText,response=KnurldSDKUtil.isEmpty(response)?eval("("+response+")"):{},response.StatusCode=httpRequest.status,configParams.errorCallBack(response),response):void 0},KnurldConstants.GET==configParams.requestType&&(url+="?"+urlEncodedData),httpRequest.open(configParams.requestType,url,configParams.async),KnurldConstants.POST==configParams.requestType&&KnurldConstants.CONTENT_TYPE_MULTIPART_FORM_DATA!=configParams.contentType&&httpRequest.setRequestHeader("Content-Type",configParams.contentType),configParams.sendAccessToken&&httpRequest.setRequestHeader("Authorization","Bearer "+KnurldConstants.ACCESS_TOKEN),configParams.sendDevID&&(KnurldSDK.isConsumer()&&!configParams.forceAdmin?httpRequest.setRequestHeader("Developer-Id",KnurldConstants.CONSUMER_DEV_ID):httpRequest.setRequestHeader("Developer-Id",KnurldConstants.DEV_ID)),httpRequest.send(urlEncodedData)},KnurldHttpRequest.uploadFile=function(e,n,t){var l=new XMLHttpRequest;if(!l)return alert("Giving up :( Cannot create an XMLHTTP instance"),!1;var r=new FormData;for(name in n)r.append(name,n[name]);l.onreadystatechange=function(){var e={};return l.readyState==XMLHttpRequest.DONE&&t.async?4==l.readyState&&(200===l.status||201===l.status||202===l.status)||KnurldConstants.DELETE==t.requestType&&204===l.status?(e=l.responseText,void 0!=t.localSuccessHandler?t.localSuccessHandler(e,t.successCallBack):t.successCallBack(e),e):(e=l.responseText,e.StatusCode=l.status,t.errorCallBack(e),e):void 0},l.open("post",e,!0),l.send(r)};var KnurldSDKUtil=KnurldSDKUtil||{};KnurldSDKUtil.isValidObj=function(e){return"undefined"!=typeof e&&null!=e},KnurldSDKUtil.isEmpty=function(e){return!(!KnurldSDKUtil.isValidObj(e)||(e=e.trim(),""==e))},KnurldSDKUtil.buildUrl=function(e,n){return n?KnurldConstants.HOST+KnurldConstants.V1+e:KnurldConstants.HOST+e},KnurldSDKUtil.buildApplicationIdUrl=function(e){return KnurldConstants.APP_URL+e},KnurldSDKUtil.buildConsumerIdUrl=function(e){return KnurldConstants.CONSUMER_URL+e},KnurldSDKUtil.getAPIParams=function(e,n,t){return KnurldSDKUtil.isValidObj(e)||(e={}),void 0===e.async&&(e.async=!0),void 0===e.requestType&&(e.requestType=KnurldConstants.GET),KnurldSDKUtil.isFunction(n)||(n=KnurldSDKUtil.commonCallBack),KnurldSDKUtil.isFunction(t)||(t=KnurldSDKUtil.commonCallBack),e.successCallBack=n,e.errorCallBack=t,e.sendDevID=!0,e.sendAccessToken=!0,e.contentType=KnurldConstants.CONTENT_TYPE_APPLICATION_JSON,e.forceAdmin=!1,e},KnurldSDKUtil.isFunction=function(e){return typeof e==typeof Function},KnurldSDKUtil.commonCallBack=function(e){},KnurldSDKUtil.setupURL=function(){KnurldConstants.APP_URL=KnurldConstants.HOST+KnurldConstants.V1+KnurldConstants.APPLICATION+KnurldConstants.URL_SEPR,KnurldConstants.CONSUMER_URL=KnurldConstants.HOST+KnurldConstants.V1+KnurldConstants.CONSUMER+KnurldConstants.URL_SEPR},KnurldSDKUtil.pausecomp=function(e){var n=new Date,t=null;do t=new Date;while(e>t-n)},app.controller("LoginCtrl",["$scope","Auth","$location","knurldAPI","$rootScope","$window","errorHandlingService","$state","toaster","$cookies","constant",function(e,n,t,l,r,s,o,a,i,d,u){angular.isUndefined(d.get("client_id"))||(e.client_id=d.get("client_id")),angular.isUndefined(d.get("client_secret"))||(e.client_secret=d.get("client_secret")),angular.isUndefined(d.get("developerId"))||(e.developerId=d.get("developerId")),e.user={devId:e.developerId,client_secret:e.client_secret,client_id:e.client_id},e.submit=function(){var n={};return NProgress.start(),n.client_id=e.user.client_id,n.client_secret=e.user.client_secret,KnurldSDK.auth.accesstoken(n,e.loginSuccess,e.loginFaild),!1},e.loginSuccess=function(l){return KnurldSDK.setConsumer(!1),d.put("client_id",e.user.client_id),d.put("client_secret",e.user.client_secret),n.isLoggedIn=!0,e.auth=n,e.user.devId=e.user.devId.trim(),"Bearer:"==e.user.devId.substring(0,7)&&(e.user.devId=e.user.devId.trim(),e.user.devId=e.user.devId.replace("Bearer:",""),e.user.devId=e.user.devId.trim()),e.user.devId="Bearer: "+e.user.devId,d.put("developerId",e.user.devId),KnurldSDK.setDevID(e.user.devId),s.sessionStorage.setItem("DEV_ID",e.user.devId),s.sessionStorage.setItem("ACCESS_TOKEN",KnurldSDK.getAccessToken()),s.sessionStorage.setItem("USER","ADMIN"),u.setCustomerLoggedIn(!1),r.$apply(function(){a.go("dashboard"),console.log(t.path())}),!1},e.loginFaild=function(e){var n=e.message;if(angular.isUndefined(n)){var t=e.fault;if(angular.isUndefined(t)){if(!angular.isUndefined(e.StatusCode)){var l=e.StatusCode;return void(0==l?alert("Unknown error"):alert("Invalid status code for API:"+l))}}else{var r=t.faultstring;if("Access Token expired"==r)return alert("Auth token expired please login again"),void state.go("login");n=r}}alert("Login Failed",n)}}]),app.controller("ConsumerLoginCtrl",["$scope","Auth","$location","knurldAPI","$rootScope","$window","errorHandlingService","$state","toaster","$cookies","constant",function(e,n,t,l,r,s,o,a,i,d,u){angular.isUndefined(d.get("username"))||(e.username=d.get("username")),angular.isUndefined(d.get("password"))||(e.password=d.get("password")),angular.isUndefined(d.get("developerId"))||(e.developerId=d.get("developerId")),angular.isUndefined(d.get("client_id"))||(e.client_id=d.get("client_id")),angular.isUndefined(d.get("client_secret"))||(e.client_secret=d.get("client_secret")),e.user={devId:e.developerId,username:e.username,password:e.password,client_secret:e.client_secret,client_id:e.client_id},e.consumer_submit=function(){var n={};return NProgress.start(),n.client_id=e.user.client_id,n.client_secret=e.user.client_secret,KnurldSDK.auth.accesstoken(n,e.loginSuccess,e.loginFaild),!1},e.submit=function(){var n={};return NProgress.start(),n.username=e.user.username,n.password=e.user.password,KnurldSDK.consumer.token(n,e.consumerloginSuccess,e.loginFaild),!1},e.consumerloginSuccess=function(n){return d.put("username",e.user.username),d.put("password",e.user.password),KnurldSDK.setConsumer(!0),s.sessionStorage.setItem("CONSUMER_DEV_ID","Bearer "+n.token),u.setCustomerLoggedIn(!0),s.sessionStorage.setItem("USER","CONSUMER"),r.$apply(function(){a.go("dashboard"),console.log(t.path())}),!1},e.loginSuccess=function(t){d.put("client_id",e.user.client_id),d.put("client_secret",e.user.client_secret),n.isLoggedIn=!0,e.auth=n,e.user.devId=e.user.devId.trim(),"Bearer:"==e.user.devId.substring(0,7)&&(e.user.devId=e.user.devId.trim(),e.user.devId=e.user.devId.replace("Bearer:",""),e.user.devId=e.user.devId.trim()),e.user.devId="Bearer: "+e.user.devId,d.put("developerId",e.user.devId),KnurldSDK.setDevID(e.user.devId),s.sessionStorage.setItem("DEV_ID",e.user.devId),s.sessionStorage.setItem("ACCESS_TOKEN",KnurldSDK.getAccessToken()),e.submit()},e.loginFaild=function(e){var n=e.message;if(angular.isUndefined(n)){var t=e.fault;if(angular.isUndefined(t)){if(!angular.isUndefined(e.StatusCode)){var l=e.StatusCode;return void(0==l?alert("Unknown error"):alert("Invalid status code for API:"+l))}}else{var r=t.faultstring;if("Access Token expired"==r)return alert("Auth token expired please login again"),void state.go("login");n=r}}alert("Login Failed",n)}}]),app.controller("DashboardCtrl",["$scope","Auth","$location","knurldAPI","$rootScope","$window","errorHandlingService","$state","toaster","$cookies","getAll","ngDialog",function(e,n,t,l,r,s,o,a,i,d,u,c){r.requests=[],e.$state=a,(""==r.status||angular.isUndefined(r.status))&&KnurldSDK.auth.status(function(n){r.status=n.version,e.status=n.version},function(n){o.proccess(n,"Status",a,i),e.$apply()}),e.status=r.status,Number.prototype.padLeft=function(e,n){var t=String(e||10).length-String(this).length+1;return t>0?new Array(t).join(n||"0")+this:this},r.cacheCustomer=function(e){(angular.isUndefined(u.getAllCustomers())||e)&&KnurldSDK.consumer.getAllInOneCall({},function(e){u.setAllCustomers(e.items)},function(e){})},r.cacheAppModel=function(e){(angular.isUndefined(u.getAllAppModels())||e)&&KnurldSDK.appModel.getAllInOneCall({},function(e){u.setAllAppModel(e.items)},function(e){})},e.logout=function(){return KnurldSDK.setAccessToken(""),"CONSUMER"==s.sessionStorage.getItem("USER")?void a.go("consumer_login"):void a.go("login")},r.cacheCustomer(!1),r.cacheAppModel(!1),r.clearLog=function(e,n){r.requests=new Array(0)}}]),app.controller("appModelController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant","$window",function(e,n,t,l,r,s,o,a,i,d,u){e.$state=t,e.customerLoggedIn="CONSUMER"==u.sessionStorage.getItem("USER");var c=[{name:"Update",width:80,cellTemplate:'<image src="images/edit.png" class="deleteImage"  ng-click="grid.appScope.update(row)" title="Update"></image>'},{name:"Delete",width:80,cellTemplate:'<image src="images/delete.png" class="deleteImage"  ng-click="grid.appScope.deleteRow(row)" title="Delete"></image>'},{headerName:"Vocabulary",field:"vocabulary",width:250},{headerName:"Id",field:"id",width:150},{headerName:"Created Time",field:"createdTime",width:90},{headerName:"Mode",field:"mode",width:120},{headerName:"Verification Length",field:"verificationLength",width:90},{headerName:"Threshold",field:"threshold",width:110},{headerName:"Enrollment Repeats",field:"enrollmentRepeats",width:110},{headerName:"Validate Enrollment",field:"validateEnrollment",width:100},{headerName:"Threshold Clearance",field:"autoThresholdClearance",width:100},{headerName:"Threshold Enable",field:"autoThresholdEnable",width:100},{headerName:"Threshold Max Rise",field:"autoThresholdMaxRise",width:100},{headerName:"Use Model Update",field:"useModelUpdate",width:100},{headerName:"Model Update Daily Limit",field:"modelUpdateDailyLimit",width:100},{headerName:"Href",field:"href",width:300}];e.deleteRow=function(n){var t={};t.appModelId=n.entity.id,KnurldSDK.appModel.del(t,function(n){i.debugLogs("KnurldSDK.appModel.del",t,n),e.deleteSuccess(n)},e.failed)};var p={sort:null};e.clearAll=function(){e.isUpdate=!1,e.gridApi.selection.clearSelectedRows()},e.addAppModel=function(){e.clearAll(),o.setAddModelRow(null),l.open({template:"views/popup/addAppModel.html",showClose:!0,closeByDocument:!1,controller:"appModelAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.deleteAppModel=function(){NProgress.start();var n={},t=o.getAddModelRow().entity.href.split("/");n.appModelId=t.pop(),KnurldSDK.appModel.del(n,function(t){i.debugLogs("KnurldSDK.appModel.del",n,t),e.deleteSuccess(t)},e.failed)},e.deleteSuccess=function(e){NProgress.done(),s.success("App Model","Successfully deleted App Model"),l.close(),t.go("dashboard",{},{})},e.appModelGrid={paginationPageSizes:[10,20,30],paginationPageSize:10,useExternalPagination:!0,useExternalSorting:!0,enableGridMenu:!0,enableColumnResizing:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:c,exporterAllDataFn:function(){return e.getPage(1,e.appModelGrid.totalItems,p.sort).then(function(){e.appModelGrid.useExternalPagination=!1,e.appModelGrid.useExternalSorting=!1,e.getPage=null})},onRegisterApi:function(n){e.gridApi=n,n.selection.on.rowSelectionChanged(e,function(n){e.customerLoggedIn||(o.setAddModelRow(n),n.isSelected?e.isUpdate=!0:e.isUpdate=!1)}),e.gridApi.core.on.sortChanged(e,function(n,t){e.getPage&&(t.length>0?p.sort=t[0].sort.direction:p.sort=null,e.getPage(n.options.paginationCurrentPage,n.options.paginationPageSize,p.sort))}),n.pagination.on.paginationChanged(e,function(n,t){e.getPage&&e.getPage(n,t,p.sort)})}},e.update=function(n){o.setAddModelRow(n),e.isUpdate=!0,l.open({template:"views/popup/addAppModel.html",showClose:!0,closeByDocument:!1,controller:"appModelAddController",className:"ngdialog-theme-default custom-width-800",scope:e})};var f,g;e.getPage=function(n,t,l){f=n,g=t,NProgress.start();var r={};r.limit=t,r.offset=(n-1)*t,KnurldSDK.appModel.get(r,function(n){i.debugLogs("KnurldSDK.appModel.get",r,n),e.success(n)},e.failed)},e.successFetchAll=function(e){i.setAllAppModel(e)},e.failedFetchAll=function(e){i.clearAllAppModel()},e.formatResponse=function(e){var n=[];return null==e||angular.isUndefined(e)?n=e:angular.forEach(e,function(e,t){var l={};angular.forEach(e,function(e,n){if("href"==n)l.id=e.split("/").pop(),l.href=e;else if("createdTime"==n){var t=new Date(e),r=[(t.getMonth()+1).padLeft(),t.getDate().padLeft(),t.getFullYear()].join("/")+" "+[t.getHours().padLeft(),t.getMinutes().padLeft(),t.getSeconds().padLeft()].join(":");l[n]=r}else l[n]=e}),n.push(l)}),n},e.success=function(n){var t=e.formatResponse(n.items);return e.appModelGrid.totalItems=n.total,NProgress.done(),0==n.items.length?void e.addAppModel():(e.appModelGrid.data=t,void e.$apply())},e.failed=function(n){a.proccess(n,"App Model",t,s),e.$apply()},e.getPage(1,e.appModelGrid.paginationPageSize)}]),app.controller("appModelAddController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll",function(e,n,t,l,r,s,o,a,i){e.save="Save",e.isUpdate=!1,e.paginationPageSize=10,e.updateVocabulary=function(e,n){for(var t in e)-1!==n.indexOf(e[t].name)&&(e[t].checked=!0)},e.getArrayAsObject=function(e){var n=[];return angular.forEach(e,function(t,l){var r={};r.name=e[l],r.checked=!1,n.push(r)}),n},e.entollment=3,e.verificationLength=3,e.globalCities=e.getArrayAsObject(r.getGlobalCities()),e.globalConutries=e.getArrayAsObject(r.getGlobalConutries()),e.colors=e.getArrayAsObject(r.getColors()),e.shapes=e.getArrayAsObject(r.getShapes()),e.cities=e.getArrayAsObject(r.getUSCities()),e.threshold=2,e.autoThresholdEnable=!0,e.modelUpdateDailyLimit=1,e.useModelUpdate=!1,e.autoThresholdMaxRise=1,e.autoThresholdClearance=2.5;var d=o.getAddModelRow();if(null!=d&&!angular.isUndefined(d)){var u=d.entity;e.id=u.href,e.autoThresholdClearance=u.autoThresholdClearance,e.autoThresholdEnable=u.autoThresholdEnable,e.autoThresholdMaxRise=u.autoThresholdMaxRise,e.enrollmentRepeats=u.enrollmentRepeats,e.modelUpdateDailyLimit=u.modelUpdateDailyLimit,e.useModelUpdate=u.useModelUpdate,e.verificationLength=u.verificationLength,e.threshold=u.threshold;var c=u.vocabulary;e.updateVocabulary(e.cities,c),e.updateVocabulary(e.globalCities,c),e.updateVocabulary(e.globalConutries,c),e.updateVocabulary(e.colors,c),e.updateVocabulary(e.shapes,c),e.isUpdate=!0,e.checkMe=!0,e.save="Update"}e.deleteAppModel=function(){NProgress.start();var n={},t=e.id.split("/");n.appModelId=t.pop(),KnurldSDK.appModel.del(n,function(t){i.debugLogs("KnurldSDK.appModel.del",n,t),e.deleteSuccess(t)},e.failed)},e.deleteSuccess=function(n){NProgress.done(),s.success("App Model","Successfully deleted App Model"),l.close(),t.go("dashboard",{},{}),e.getPage(1,e.paginationPageSize)},e.saveAppModel=function(){NProgress.start();var n=[],t={};for(var l in e.cities)1==e.cities[l].checked&&n.push(e.cities[l].name);for(var l in e.shapes)1==e.shapes[l].checked&&n.push(e.shapes[l].name);for(var l in e.colors)1==e.colors[l].checked&&n.push(e.colors[l].name);for(var l in e.globalConutries)1==e.globalConutries[l].checked&&n.push(e.globalConutries[l].name);for(var l in e.globalCities)1==e.globalCities[l].checked&&n.push(e.globalCities[l].name);if(t.enrollmentRepeats=e.entollment,t.vocabulary=n,t.verificationLength=e.verificationLength,t.threshold=e.threshold,e.isUpdate){var n=e.id.split("/");t.appModelId=n.pop(),KnurldSDK.appModel.update(t,function(n){i.debugLogs("KnurldSDK.appModel.update",t,n),e.success(n)},e.failed)}else t.autoThresholdEnable=e.autoThresholdEnable,t.autoThresholdClearance=e.autoThresholdClearance,t.autoThresholdMaxRise=e.autoThresholdMaxRise,t.useModelUpdate=e.useModelUpdate,t.modelUpdateDailyLimit=e.modelUpdateDailyLimit,KnurldSDK.appModel.create(t,function(n){i.debugLogs("KnurldSDK.appModel.create",t,n),e.success(n)},e.failed)},e.success=function(r){NProgress.done(),e.isUpdate?s.success("App Model","Successfully updated App Model"):(s.success("App Model","Successfully added App Model"),n.cacheAppModel(!0)),l.close(),t.go("dashboard",{},{}),e.getPage(1,e.paginationPageSize)},e.failed=function(n){a.proccess(n,"Add App Model",t,s),e.$apply()}}]),app.controller("consumerAddController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll",function(e,n,t,l,r,s,o,a,i){e.save="Save",e.isUpdate=!1,e.gender="M",e.paginationPageSize=10;var d=o.getConsumerRow();if(null!=d&&!angular.isUndefined(d)){var u=d.entity;e.id=u.href,e.isUpdate=!0,e.save="Update",e.checkMe=!0,e.gender=u.gender,e.username=u.username,e.password="****"}e.saveConsumer=function(){NProgress.start();var n={};if(n.Gender=e.gender,n.username=e.username,n.password=e.password,e.isUpdate){var t=e.id.split("/");n.consumerId=t.pop(),KnurldSDK.consumer.update(n,function(t){i.debugLogs("KnurldSDK.consumer.update",n,t),e.success(t)},e.failed)}else n.modelUpdateDailyLimit=e.modelUpdateDailyLimit,KnurldSDK.consumer.create(n,function(t){i.debugLogs("KnurldSDK.consumer.create",n,t),e.success(t)},e.failed)},e.success=function(r){NProgress.done(),e.isUpdate?s.success("Consumer","Successfully updated Consumer"):(s.success("Consumer","Successfully added Consumer"),n.cacheCustomer(!0)),l.close(),t.go("consumer",{},{}),e.getPage(1,e.paginationPageSize)},e.failed=function(n){a.proccess(n,"Consumer operation failed",t,s),e.$apply()}}]),app.controller("enrollAddController",["$scope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant",function($scope,$state,ngDialog,words,toaster,store,errorHandlingService,getAll,constant){$scope._appModel=getAll.getAllAppModels(),$scope._getEnrollments=getAll.getAllEnrollments(),$scope._consumer=getAll.getAllCustomers(),$scope._verifications=getAll.getAllVerifications(),$scope.repeats=0,$scope.paginationPageSize=10,$scope.getPhraseTextWithId=function(e,n){var t="";return angular.forEach(e,function(e,l){for(var r=0;n>r;r++)t+=e+"      "}),$scope.phrases=e,$scope.repeats=n,t},$scope.getPhraseText=function(e){var n;return angular.forEach($scope._appModel,function(t,l){t.id==e&&(n=t)}),$scope.getPhraseTextWithId(n.vocabulary,n.enrollmentRepeats)},$scope.save="Save",$scope.isUpdate=!1,$scope.analyseIntervalId,$scope.enrollmenttTimerId,$scope.isEditDisabled=!1,$scope.jsonVal,$scope.audioUrl,$scope.enroll="recording";var _fileData="";$scope.analyseProgress=0,$scope.isAddUpdate=constant.isAddAndUpdateEnrollmentClicked();var row=store.getEnrollmentRow();if(null==row||angular.isUndefined(row)){var consumer=store.getConsumerRow(),appModel=store.getAddModelRow();if(null!=consumer&&!angular.isUndefined(consumer)){var arr=consumer.entity.href.split("/");$scope.consumer=arr.pop()}null==appModel||angular.isUndefined(appModel)||(arr=appModel.entity.href.split("/"),$scope.appModel=arr.pop(),$scope.phrases=appModel.entity.vocabulary,$scope.phrasesText=$scope.getPhraseTextWithId($scope.phrases,appModel.enrollmentRepeats),$scope.directions="Record the user speaking all of the given phrases, each repeated n times")}else{var entity=row.entity;$scope.id=entity.href,$scope.isEditDisabled=!0,$scope.isUpdate=!0,$scope.appModel=entity["app-model"],$scope.consumer=entity.consumer,$scope.phrases=$scope.appModel.vocabulary,$scope.phrasesText=$scope.getPhraseText($scope.appModel),$scope.directions=entity.instructions.directions}$scope.isAddUpdate&&($scope.isEditDisabled=!1,$scope.isUpdate=!0),$scope.changeAppModel=function(e){var n=e.split("_");$scope.appModel=n[1];var t=n[0].replace("[","").replace("]","").replace(/['"]+/g,"").split(",");$scope.phrases=[],angular.forEach(t,function(e,n){$scope.phrases.push(e)}),$scope.phrasesText=$scope.getPhraseText($scope.appModel),$scope.directions="Record the user speaking all of the given phrases, each repeated n times"},$scope.changeConsumer=function(e){$scope.consumer=e},$scope.generateUUID=function(){var e=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:3&t|8).toString(16)});return n},$scope.analyse=function(){if(NProgress.start(),$scope.isDisable=!0,"recording"==$scope.enroll){if(angular.isUndefined($scope.recordedInput))return toaster.error("Knurld","File is not ready please record file"),void NProgress.done();if(0!=$scope.analyseProgress)return toaster.error("Knurld","File analyse in progress, please wait..."),void NProgress.done();$scope.analyseProgress=1;var e={};e.file=$scope.recordedInput,e.fileName=$scope.generateUUID()+".wav",KnurldSDK.uploadFile(store.getUploadUrl(),e,function(n){getAll.debugLogs("KnurldSDK.uploadFile",e,n),$scope.fileUploadSuccess(n)},$scope.failed)}if("file"==$scope.enroll){if(angular.isUndefined($scope.file))return toaster.error("Knurld","Please select file"),void NProgress.done();var e={};e.file=$scope.file,e.fileName=$scope.generateUUID()+".wav",KnurldSDK.uploadFile(store.getUploadUrl(),e,function(n){getAll.debugLogs("KnurldSDK.uploadFile",e,n),$scope.fileUploadSuccess(n)},$scope.failed)}if("url"==$scope.enroll){if(angular.isUndefined($scope.url))return toaster.error("Knurld","Please provide url"),void NProgress.done();var n={};n.audioUrl=$scope.url,KnurldSDK.analytics.url(n,function(e){getAll.debugLogs("KnurldSDK.analytics.url",n,e),$scope.analyseUploadSuccess(e)},$scope.failed)}},$scope.fileUploadSuccess=function(e){e=e.slice(0,-1)+"1",$scope.audioUrl=e,$scope.analyseProgress=1;var n={};n.audioUrl=e,KnurldSDK.analytics.url(n,function(e){getAll.debugLogs("KnurldSDK.analytics.url",n,e),$scope.analyseUploadSuccess(e)},$scope.failed)},$scope.analyseUploadSuccess=function(e){var n={};n.isTimer=!0,n.interval=2e3,n.fileData=$scope.recordedInput,n.id=e.taskName,$scope.analyseIntervalId=KnurldSDK.analytics.get(n,function(e){getAll.debugLogs("KnurldSDK.analytics.get",n,e),$scope.analyseSuccess(e)},$scope.failed)},$scope.analyseSuccess=function(e){if("completed"==e.taskStatus){NProgress.done(),KnurldSDK.clearInterval($scope.analyseIntervalId),$scope.analyseIntervalId="-1",$scope.analyseProgress=0;var n=e.intervals,t=0;angular.isUndefined($scope.phrases)||angular.forEach(n,function(e,n){var l=Math.floor(t/$scope.repeats);if(angular.isUndefined(l)||(e.phrase=$scope.phrases[l]),constant.isAdJust600MiliGap()){var r=e.stop-e.start;r<constant.getMilisRequired()&&(e.stop=e.stop+(constant.getMilisRequired()-r))}t++}),$scope.jsonVal=JSON.stringify(e.intervals),$scope.$apply()}$scope.autoSave&&$scope.saveEnrollment()},$scope.deleteEnrollment=function(){NProgress.start();var e={},n=$scope.id.split("/");e.enrollmentId=n.pop(),KnurldSDK.enrollment.del(e,function(n){getAll.debugLogs("KnurldSDK.enrollment.del",e,n),$scope.deleteSuccess(n)},$scope.failed)},$scope.deleteSuccess=function(e){NProgress.done(),toaster.success("Enrollment","Successfully deleted Enrollment"),ngDialog.close(),$state.go("enrollment",{},{}),$scope.getPage(1,$scope.paginationPageSize)},$scope.autoSave=!1,$scope.saveEnrollment=function(){if((""==$scope.jsonVal||angular.isUndefined($scope.jsonVal))&&$scope.isUpdate)return $scope.autoSave=!0,void $scope.analyse();if(NProgress.start(),!$scope.isUpdate){var e={};return e.consumerId=$scope.consumer,e.applicationId=$scope.appModel,void KnurldSDK.enrollment.create(e,function(n){getAll.debugLogs("KnurldSDK.enrollment.create",e,n),$scope.success(n)},$scope.failed)}if("recording"==$scope.enroll||"file"==$scope.enroll)$scope.commonSave($scope.audioUrl);else if("url"==$scope.enroll){if(angular.isUndefined($scope.url))return toaster.error("Knurld","Please provide url"),void NProgress.done();$scope.commonSave($scope.url)}},$scope.commonSave=function(audioUrl){var inputs={};angular.isUndefined($scope.jsonVal)||(inputs.intervals=eval($scope.jsonVal)),inputs.enrollmentRepeats=$scope.repeats,inputs.vocabulary=$scope.phrases,inputs.consumerId=$scope.consumer,inputs.applicationId=$scope.appModel,inputs.enrollmentUrl=audioUrl,KnurldSDK.enrollment.createAndUpdate(inputs,function(e){getAll.debugLogs("KnurldSDK.enrollment.createAndUpdate",inputs,e),$scope.saveSuccess(e)},$scope.failed)},$scope.saveSuccess=function(e){var n={},t=e.href.split("/");n.enrollmentId=t.pop(),n.isTimer=!0,n.interval=2e3,$scope.enrollmenttTimerId=KnurldSDK.enrollment.get(n,function(e){getAll.debugLogs("KnurldSDK.enrollment.get",n,e),$scope.getSuccess(e)},$scope.failed)},$scope.getSuccess=function(e){"completed"==e.status&&(KnurldSDK.clearInterval($scope.enrollmenttTimerId),toaster.success("Enrollment","Enrollment Done"),ngDialog.close(),$state.go("enrollment",{},{}),$scope.getPage(1,$scope.paginationPageSize)),"failed"==e.status&&(KnurldSDK.clearInterval($scope.enrollmenttTimerId),toaster.error("Enrollment","Enrollment fetch failed"),ngDialog.close(),$state.go("enrollment",{},{}),$scope.getPage(1,$scope.paginationPageSize))},$scope.uploadFile=function(e){$scope.file=e.target.files[0]},$scope.success=function(e){NProgress.done(),$scope.isUpdate?toaster.success("Enrollment","Successfully updated Enrollment"):toaster.success("Enrollment","Successfully added Enrollment"),ngDialog.close(),$state.go("enrollment",{},{}),$scope.getPage(1,$scope.paginationPageSize)},$scope.failed=function(e){$scope.analyseProgress=0,errorHandlingService.proccess(e,"Enrollment operation failed",$state,toaster),$scope.$apply()}}]),app.directive("customOnChange",function(){return{restrict:"A",link:function(e,n,t){var l=e.$eval(t.customOnChange);n.bind("change",l)}}}),app.controller("callAddController",["$scope","$state","ngDialog","words","toaster","store","errorHandlingService",function(e,n,t,l,r,s,o){e.save="Save",e.isUpdate=!1;var a=s.getCallRow();if(null!=a&&!angular.isUndefined(a)){var i=a.entity;e.id=i.href}e.deleteCall=function(){NProgress.start();var n={},t=e.id.split("/");n.callId=t.pop(),KnurldSDK.call.del(n,e.deleteSuccess,e.failed)},e.saveCall=function(){NProgress.start();var n={};if(e.isUpdate){var t=e.id.split("/");n.appModelId=t.pop(),KnurldSDK.call.update(n,e.success,e.failed)}else n.number=e.number,KnurldSDK.call.create(n,e.success,e.failed)},e.deleteSuccess=function(e){NProgress.done(),r.success("Calls ","Successfully deleted Call "),t.close(),n.go("calls")},e.success=function(l){NProgress.done(),e.isUpdate?r.success("Call ","Successfully updated Call "):r.success("Call ","Successfully added Call "),t.close(),n.go("calls")},e.failed=function(t){o.proccess(t,"Add Call ",n,r),e.$apply()}}]),app.controller("verificationAddController",["$scope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant",function($scope,$state,ngDialog,words,toaster,store,errorHandlingService,getAll,constant){$scope.save="Save",$scope.isUpdate=!1,$scope.analyseIntervalId,$scope.verificationIntervalId,$scope.isDisable,$scope.jsonVal,$scope.audioUrl,$scope.autoSave=!1,$scope._appModel=getAll.getAllAppModels(),$scope._getEnrollments=getAll.getAllEnrollments(),$scope._consumer=getAll.getAllCustomers(),$scope._verifications=getAll.getAllVerifications(),$scope.verify="recording";var _fileData="";$scope.paginationPageSize=10,$scope.changeAppModel=function(e){$scope.appModel=e},$scope.changeConsumer=function(e){$scope.consumer=e};var row=store.getVerificationRow(),_fileData="";if($scope.analyseProgress=0,null==row||angular.isUndefined(row)){var consumer=store.getConsumerRow(),appModel=store.getAddModelRow();if(null!=consumer&&!angular.isUndefined(consumer)){var arr=consumer.entity.href.split("/");$scope.consumer=arr.pop()}null==appModel||angular.isUndefined(appModel)||(arr=appModel.entity.href.split("/"),$scope.appModel=arr.pop())}else{var entity=row.entity;$scope.id=entity.href;var entity=row.entity;$scope.checkMe=!0,$scope.appModel=entity["app-model"],$scope.consumer=entity.consumer,$scope.isUpdate=!0,$scope.phrases=entity.instructions.data.phrases,$scope.directions=entity.instructions.directions}$scope.uploadFile=function(e){$scope.file=e.target.files[0]},$scope.generateUUID=function(){var e=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:3&t|8).toString(16)});return n},$scope.analyse=function(){if(NProgress.start(),$scope.isDisable=!0,"recording"==$scope.verify){if(angular.isUndefined($scope.recordedInput))return toaster.error("Knurld","File is not ready please record file"),void NProgress.done();if(0!=$scope.analyseProgress)return toaster.error("Knurld","File analyse in progress, please wait..."),void NProgress.done();$scope.analyseProgress=1;var e={};e.file=$scope.recordedInput,e.fileName=$scope.generateUUID()+".wav",KnurldSDK.uploadFile(store.getUploadUrl(),e,function(n){getAll.debugLogs("KnurldSDK.uploadFile",e,n),$scope.fileUploadSuccess(n)},$scope.failed)}if("file"==$scope.verify){if(angular.isUndefined($scope.file))return toaster.error("Knurld","Please select file"),void NProgress.done();var e={};e.file=$scope.file,e.fileName=$scope.generateUUID()+".wav",KnurldSDK.uploadFile(store.getUploadUrl(),e,function(n){getAll.debugLogs("KnurldSDK.uploadFile",e,n),$scope.fileUploadSuccess(n)},$scope.failed)}if("url"==$scope.verify){if(angular.isUndefined($scope.url))return toaster.error("Knurld","Please provide url"),void NProgress.done();var n={};n.audioUrl=$scope.url,KnurldSDK.analytics.url(n,function(e){getAll.debugLogs("KnurldSDK.analytics.url",n,e),$scope.analyseUploadSuccess(e)},$scope.failed)}},$scope.fileUploadSuccess=function(e){e=e.slice(0,-1)+"1",$scope.audioUrl=e,$scope.analyseProgress=1;var n={};n.audioUrl=e,KnurldSDK.analytics.url(n,function(e){getAll.debugLogs("KnurldSDK.analytics.url",n,e),$scope.analyseUploadSuccess(e)},$scope.failed)},$scope.analyseUploadSuccess=function(e){var n={};n.isTimer=!0,n.interval=2e3,n.fileData=$scope.recordedInput,n.id=e.taskName,$scope.analyseIntervalId=KnurldSDK.analytics.get(n,function(e){getAll.debugLogs("KnurldSDK.analytics.get",n,e),$scope.analyseSuccess(e)},$scope.failed)},$scope.analyseSuccess=function(e){if("completed"==e.taskStatus){NProgress.done(),KnurldSDK.clearInterval($scope.analyseIntervalId),$scope.analyseIntervalId="-1",$scope.analyseProgress=0;var n=e.intervals,t=0;angular.forEach(n,function(e,n){if(angular.isUndefined(t)||(e.phrase=$scope.phrases[t]),constant.isAdJust600MiliGap()){var l=e.stop-e.start;l<constant.getMilisRequired()&&(e.stop=e.stop+(constant.getMilisRequired()-l))}t++}),$scope.jsonVal=JSON.stringify(e.intervals),$scope.$apply()}$scope.autoSave&&$scope.saveVerification()},$scope.deleteVerification=function(){NProgress.start();var e={},n=$scope.id.split("/");e.verificationId=n.pop(),KnurldSDK.verification.del(e,function(n){getAll.debugLogs("KnurldSDK.verification.del",e,n),$scope.deleteSuccess(n)},$scope.failed)},$scope.deleteSuccess=function(e){NProgress.done(),toaster.success("Verification","Successfully deleted verification"),
ngDialog.close(),$state.go("verification",{},{}),$scope.getPage(1,$scope.paginationPageSize)},$scope.saveVerification=function(){if((""==$scope.jsonVal||angular.isUndefined($scope.jsonVal))&&$scope.isUpdate)return $scope.autoSave=!0,void $scope.analyse();if(NProgress.start(),!$scope.isUpdate){var inputs={};return inputs.consumerId=$scope.consumer,inputs.applicationId=$scope.appModel,void KnurldSDK.verification.create(inputs,function(e){getAll.debugLogs("KnurldSDK.verification.create",inputs,e),$scope.success(e)},$scope.failed)}if("recording"==$scope.verify||"file"==$scope.verify){var inputs={};inputs.intervals=eval($scope.jsonVal);var arr=$scope.id.split("/");inputs.verificationId=arr.pop(),inputs.verificationUrl=$scope.audioUrl,KnurldSDK.verification.update(inputs,function(e){getAll.debugLogs("KnurldSDK.verification.update",inputs,e),$scope.saveSuccess(e)},$scope.failed)}else if("url"==$scope.verify){if(angular.isUndefined($scope.url))return toaster.error("Knurld","Please provide url"),void NProgress.done();var inputs={};angular.isUndefined($scope.jsonVal)||(inputs.intervals=eval($scope.jsonVal)),inputs.phrases=$scope.phrases;var arr=$scope.id.split("/");inputs.verificationId=arr.pop(),inputs.verificationUrl=$scope.url,KnurldSDK.verification.create(inputs,function(e){getAll.debugLogs("KnurldSDK.verification.create",inputs,e),$scope.saveSuccess(e)},$scope.failed)}},$scope.saveSuccess=function(e){var n={},t=e.href.split("/");n.verificationId=t.pop(),n.isTimer=!0,n.interval=2e3,$scope.verificationIntervalId=KnurldSDK.verification.get(n,function(e){getAll.debugLogs("KnurldSDK.verification.get",n,e),$scope.getSuccess(e)},$scope.failed)},$scope.getSuccess=function(e){"completed"==e.status&&(KnurldSDK.clearInterval($scope.verificationIntervalId),e.verified?toaster.success("Verification","Verification passed"):toaster.error("Verification","Verification failed"),ngDialog.close(),$state.go("verification",{},{}),$scope.getPage(1,$scope.paginationPageSize)),"failed"==e.status&&(KnurldSDK.clearInterval($scope.verificationIntervalId),toaster.error("Verification","Verification fetch failed"),ngDialog.close(),$state.go("verification",{},{}),$scope.getPage(1,$scope.paginationPageSize))},$scope.success=function(e){NProgress.done(),$scope.isUpdate?toaster.success("Verification","Successfully updated verification"):toaster.success("Verification","Successfully added verification"),ngDialog.close(),$state.go("verification",{},{}),$scope.getPage(1,$scope.paginationPageSize)},$scope.failed=function(e){$scope.analyseProgress=0,errorHandlingService.proccess(e,"verification operation failed",$state,toaster),$scope.$apply()}}]),app.directive("customOnChange",function(){return{restrict:"A",link:function(e,n,t){var l=e.$eval(t.customOnChange);n.bind("change",l)}}}),app.service("store",function(){var e,n,t,l,r,s="https://knurldupload.herokuapp.com/rest/file/upload";return{getAddModelRow:function(){return e},setAddModelRow:function(n){e=n},getConsumerRow:function(){return n},setConsumerRow:function(e){n=e},getEnrollmentRow:function(){return t},setEnrollmentRow:function(e){t=e},getCallRow:function(){return l},setCallRow:function(e){l=e},getVerificationRow:function(){return r},setVerificationRow:function(e){r=e},getUploadUrl:function(){return s}}}),app.service("getAll",["$rootScope",function(e){var n,t,l,r;this.getAllAppModels=function(){return n},this.fetchAllAppModel=function(e,n){KnurldSDK.appModel.getAll({},e,n)},this.setAllAppModel=function(e){for(var t=0;t<e.length;t++)e[t].id=e[t].href.split("/").pop();n=e},this.clearAllAppModel=function(){n={}},this.getAllEnrollments=function(){return t},this.fetchAllEnrollments=function(e,n){KnurldSDK.enrollment.getAll({},e,n)},this.setAllEnrollments=function(e){for(var n=0;n<e.length;n++)e[n].id=e[n].href.split("/").pop();t=e},this.clearAllEnrollments=function(){t={}},this.getAllCustomers=function(){return l},this.fetchAllCustomers=function(e,n){KnurldSDK.consumer.getAll({},e,n)},this.setAllCustomers=function(e){for(var n=0;n<e.length;n++)e[n].id=e[n].href.split("/").pop();l=e},this.clearAllCustomers=function(){r={}},this.getAllVerifications=function(){return r},this.fetchAllVerifications=function(e,n){KnurldSDK.verification.getAll({},e,n)},this.setAllVerifications=function(e){for(var n=0;n<_allCustomers;n++)e[n].id=e[n].href.split("/").pop();r=e},this.clearAllVerifications=function(){r={}},this.log=function(e){console.log(e)},this.debugLogs=function(n,t,l){var r={};r.url=n+"(inputs, successCallback, errorCallBack)";var s="var inputs={}  ";angular.forEach(t,function(e,n){s=s+"inputs."+n+"="+e+";"}),r.requestParams=s,r.response=l,e.requests.push(r)}}]),app.controller("enrollmentController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant",function(e,n,t,l,r,s,o,a,i,d){e.$state=t,d.setAddAndUpdateEnrollmentClicked(!1),e._appModel=i.getAllAppModels(),e._consumer=i.getAllCustomers();var u='<image src="images/edit.png" class="deleteImage"  ng-hide={{row.entity.status=="removing"||row.entity.status=="completed"||row.entity.status=="failed"}} ng-click="grid.appScope.enroll(row)" title="Enroll"></image>',c='<image src="images/delete.png" class="deleteImage" ng-hide={{row.entity.status=="removing"}} ng-click="grid.appScope.delete(row)" title="Delete"></image>',p=[{name:"Update",width:80,cellTemplate:u},{name:"Delete",width:80,cellTemplate:c},{headerName:"Vocabulary",field:"vocabulary",width:250},{headerName:"Status",field:"status",width:100},{headerName:"App-Model",field:"app-model",width:200},{headerName:"Consumer",field:"consumer",width:200},{headerName:"Consumer Name",field:"consumerName",width:200},{headerName:"Created Time",field:"createdTime",width:90},{headerName:"Instructions",field:"instructions",width:200},{headerName:"Href",field:"href",width:300}],f={sort:null};e.enrollemntGrid={paginationPageSizes:[10,20,30],paginationPageSize:10,useExternalPagination:!0,useExternalSorting:!0,enableGridMenu:!0,enableColumnResizing:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:p,exporterAllDataFn:function(){return e.getPage(1,e.enrollemntGrid.totalItems,f.sort).then(function(){e.enrollemntGrid.useExternalPagination=!1,e.enrollemntGrid.useExternalSorting=!1,e.getPage=null})},rowStyle:function(e){var n=e.entity.status;return"completed"==n?"green":"failed"==n?"red":"removing"==n?"grey":"yellow"},rowTemplate:d.getTemplate(),onRegisterApi:function(n){e.gridApi=n,n.selection.on.rowSelectionChanged(e,function(n){o.setEnrollmentRow(n),n.isSelected?"completed"==n.entity.status||"failed"==n.entity.status||"removing"==n.entity.status?e.isUpdate=!1:e.isUpdate=!0:e.isUpdate=!1,e.isDelete=!0}),e.gridApi.core.on.sortChanged(e,function(n,t){e.getPage&&(t.length>0?f.sort=t[0].sort.direction:f.sort=null,e.getPage(n.options.paginationCurrentPage,n.options.paginationPageSize,f.sort))}),n.pagination.on.paginationChanged(e,function(n,t){e.getPage&&e.getPage(n,t,f.sort)})}};var g,m;e.getPage=function(n,t,l){e.refreshGrid(),g=n,m=t,NProgress.start();var r={};r.limit=t,r.offset=(n-1)*t,KnurldSDK.enrollment.get(r,function(n){i.debugLogs("KnurldSDK.enrollment.get",r,n),e.success(n)},e.failed)},e.refreshGrid=function(){e.enrollemntGrid.data=[],e.$$phase||e.$apply()},e["delete"]=function(n){NProgress.start();var t={};t.enrollmentId=n.entity.id,KnurldSDK.enrollment.del(t,function(n){i.debugLogs("KnurldSDK.enrollment.del",t,n),e.deleteSuccess(n)},e.failed)},e.deleteSuccess=function(n){NProgress.done(),s.success("Enrollment","Successfully deleted Enrollment"),l.close(),t.go("enrollment",{},{}),e.getPage(1,e.enrollemntGrid.paginationPageSize)},e.clearAll=function(){e.isUpdate=!1,e.gridApi.selection.clearSelectedRows()},e.addEnrollment=function(){d.setAddAndUpdateEnrollmentClicked(!1),o.setEnrollmentRow(null),e.clearAll(),l.open({template:"views/popup/addEnroll.html",showClose:!0,closeByDocument:!1,controller:"enrollAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.addAndUpdateEnrollment=function(){d.setAddAndUpdateEnrollmentClicked(!0),o.setEnrollmentRow(null),e.clearAll(),l.open({template:"views/popup/addEnroll.html",showClose:!0,closeByDocument:!1,controller:"enrollAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.enroll=function(n){o.setEnrollmentRow(n),e.isUpdate=!0,l.open({template:"views/popup/addEnroll.html",showClose:!0,closeByDocument:!1,controller:"enrollAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.successFetchAll=function(e){i.setAllEnrollments(e)},e.failedFetchAll=function(e){i.clearAllEnrollments()},e.formatResponse=function(n){var t=[];return null==n||angular.isUndefined(n)?t=n:angular.forEach(n,function(n,l){var r={};angular.forEach(n,function(n,t){if("href"==t)r.id=n.split("/").pop(),r.href=n;else if("app-model"==t){var l=n.href.split("/").pop();r["app-model"]=l,angular.isUndefined(e._appModel)&&(e._appModel=i.getAllAppModels()),null==e._appModel||angular.isUndefined(e._appModel)||angular.forEach(e._appModel,function(e,n){e.id==l&&(r.vocabulary=e.vocabulary)})}else if("consumer"==t){var s=n.href.split("/").pop();r.consumer=s,angular.isUndefined(e._consumer)&&(e._consumer=i.getAllCustomers()),null==e._consumer||angular.isUndefined(e._consumer)||angular.forEach(e._consumer,function(e,n){e.id==s&&(r.consumerName=e.username)})}else if("createdTime"==t){var o=new Date(n),a=[(o.getMonth()+1).padLeft(),o.getDate().padLeft(),o.getFullYear()].join("/")+" "+[o.getHours().padLeft(),o.getMinutes().padLeft(),o.getSeconds().padLeft()].join(":");r[t]=a}else r[t]=n}),t.push(r)}),t},e.success=function(n){var t=e.formatResponse(n.items);e.enrollemntGrid.totalItems=n.total,e.enrollemntGrid.data=t,NProgress.done(),e.$apply()},e.failed=function(n){a.proccess(n,"Enrollment",t,s),e.$apply()},e.getPage(1,e.enrollemntGrid.paginationPageSize)}]),app.controller("verificationController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant",function(e,n,t,l,r,s,o,a,i,d){e.$state=t,e._appModel=i.getAllAppModels(),e._consumer=i.getAllCustomers();var u='<image src="images/edit.png" class="deleteImage"  ng-hide={{row.entity.status=="removing"||row.entity.status=="completed"||row.entity.status=="failed"}} ng-click="grid.appScope.verify(row)" title="Verify"></image>',c='<image src="images/delete.png" class="deleteImage" ng-hide={{row.entity.status=="removing"}} ng-click="grid.appScope.delete(row)" title="Delete"></image>',p=[{name:"Update",width:80,cellTemplate:u},{name:"Delete",width:80,cellTemplate:c},{headerName:"Vocabulary",field:"vocabulary",width:250},{headerName:"Status",field:"status",width:100},{headerName:"Verified",field:"verified",width:100},{headerName:"Verified Phrases",field:"verified_phrases",width:150},{headerName:"App-Model",field:"app-model",width:200},{headerName:"Consumer",field:"consumer",width:200},{headerName:"Consumer Name",field:"consumerName",width:200},{headerName:"Created Time",field:"createdTime",width:90},{headerName:"Instructions",field:"instructions",width:200},{headerName:"Href",field:"href",width:300}],f={sort:null};e.clearAll=function(){e.isUpdate=!1,e.gridApi.selection.clearSelectedRows()},e.addVerification=function(){e.clearAll(),o.setVerificationRow(null),l.open({template:"views/popup/addVerification.html",showClose:!0,closeByDocument:!1,controller:"verificationAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e["delete"]=function(n){NProgress.start();var t={};t.verificationId=n.entity.id,KnurldSDK.verification.del(t,function(n){i.debugLogs("KnurldSDK.verification.del",t,n),e.deleteSuccess(n)},e.failed)},e.deleteSuccess=function(n){NProgress.done(),s.success("Verification","Successfully deleted verification"),l.close(),t.go("verification",{},{}),e.getPage(1,e.verificationGrid.paginationPageSize)},e.verificationGrid={paginationPageSizes:[10,20,30],paginationPageSize:10,useExternalPagination:!0,useExternalSorting:!0,enableGridMenu:!0,enableColumnResizing:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:p,exporterAllDataFn:function(){return e.getPage(1,e.verificationGrid.totalItems,f.sort).then(function(){e.verificationGrid.useExternalPagination=!1,e.verificationGrid.useExternalSorting=!1,e.getPage=null})},rowStyle:function(e){var n=e.entity.status;return"completed"==n?e.entity.verified?"green":"darkRed":"failed"==n?"red":"yellow"},rowTemplate:d.getTemplate(),onRegisterApi:function(n){e.gridApi=n,e.gridApi.core.on.sortChanged(e,function(n,t){e.getPage&&(t.length>0?f.sort=t[0].sort.direction:f.sort=null,e.getPage(n.options.paginationCurrentPage,n.options.paginationPageSize,f.sort))}),n.selection.on.rowSelectionChanged(e,function(n){o.setVerificationRow(n),n.isSelected?"completed"==n.entity.status||"failed"==n.entity.status?e.isUpdate=!1:e.isUpdate=!0:e.isUpdate=!1,e.isDelete=!0}),n.pagination.on.paginationChanged(e,function(n,t){e.getPage&&e.getPage(n,t,f.sort)})}},e.verify=function(n){o.setVerificationRow(n),e.isUpdate=!0,l.open({template:"views/popup/addVerification.html",showClose:!0,closeByDocument:!1,controller:"verificationAddController",className:"ngdialog-theme-default custom-width-800",scope:e})};var g,m;e.getPage=function(n,t,l){e.refreshGrid(),g=n,m=t,NProgress.start();var r={};r.limit=t,r.offset=(n-1)*t,KnurldSDK.verification.get(r,function(n){i.debugLogs("KnurldSDK.verification.get",r,n),e.success(n)},e.failed)},e.refreshGrid=function(){e.verificationGrid.data=[],e.$$phase||e.$apply()},e.formatResponse=function(n){var t=[];return null==n||angular.isUndefined(n)?t=n:angular.forEach(n,function(n,l){var r={};angular.forEach(n,function(n,t){if("href"==t)r.id=n.split("/").pop(),r.href=n;else if("app-model"==t){var l=n.href.split("/").pop();r["app-model"]=l,angular.isUndefined(e._appModel)&&(e._appModel=i.getAllAppModels()),null==e._appModel||angular.isUndefined(e._appModel)||angular.forEach(e._appModel,function(e,n){e.id==l&&(r.vocabulary=e.vocabulary)})}else if("consumer"==t){var s=n.href.split("/").pop();r.consumer=s,angular.isUndefined(e._consumer)&&(e._consumer=i.getAllCustomers()),null==e._consumer||angular.isUndefined(e._consumer)||angular.forEach(e._consumer,function(e,n){e.id==s&&(r.consumerName=e.username)})}else if("createdTime"==t){var o=new Date(n),a=[(o.getMonth()+1).padLeft(),o.getDate().padLeft(),o.getFullYear()].join("/")+" "+[o.getHours().padLeft(),o.getMinutes().padLeft(),o.getSeconds().padLeft()].join(":");r[t]=a}else r[t]=n}),t.push(r)}),t},e.success=function(n){var t=e.formatResponse(n.items);NProgress.done();e.verificationGrid.totalItems=n.total,e.verificationGrid.data=t,e.$apply()},e.failed=function(e){a.proccess(e,"Verification",t,s),console.log(e)},e.getPage(1,e.verificationGrid.paginationPageSize),e.successFetchAll=function(e){i.setAllVerifications(e)},e.failedFetchAll=function(e){i.clearAllVerifications()}}]),app.controller("consumerController",["$scope","$rootScope","$state","ngDialog","words","toaster","store","errorHandlingService","getAll","constant","$window",function(e,n,t,l,r,s,o,a,i,d,u){u.sessionStorage.getItem("USER"),e.gridApi={},e.customerLoggedIn="CONSUMER"==u.sessionStorage.getItem("USER");var c='<image src="images/edit.png" class="deleteImage"  ng-hide={{row.entity.role=="admin"}} ng-click="grid.appScope.updateConsumer(row)" title="Update"></image>',p='<image src="images/delete.png" class="deleteImage" ng-hide={{row.entity.role=="admin"}} ng-click="grid.appScope.deleteConsumer(row)" title="Delete"></image>',f=[{name:"Update",width:80,cellTemplate:c},{name:"Delete",width:80,cellTemplate:p},{headerName:"Username",field:"username",width:100},{headerName:"Role",field:"role",width:100},{headerName:"Last Enrollment",field:"lastCompletedEnrollment",width:200},{headerName:"Last Verification",field:"lastVerification",width:200},{headerName:"Href",field:"href",width:300}];e.$state=t;var g={sort:null};e.clearAll=function(){e.isUpdate=!1,e.gridApi.selection.clearSelectedRows()},e.addConsumer=function(){e.clearAll(),o.setConsumerRow(null),l.open({template:"views/popup/addConsumer.html",showClose:!0,closeByDocument:!1,controller:"consumerAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.consumerGrid={paginationPageSizes:[10,20,30],paginationPageSize:10,useExternalPagination:!0,useExternalSorting:!0,enableGridMenu:!0,enableColumnResizing:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,columnDefs:f,exporterAllDataFn:function(){return e.getPage(1,e.consumerGrid.totalItems,g.sort).then(function(){e.consumerGrid.useExternalPagination=!1,e.consumerGrid.useExternalSorting=!1,e.getPage=null})},onRegisterApi:function(n){e.gridApi=n,n.selection.on.rowSelectionChanged(e,function(n){e.customerLoggedIn||(o.setConsumerRow(n),n.isSelected?e.isUpdate=!0:e.isUpdate=!1)}),e.updateConsumer=function(n){o.setConsumerRow(n),e.isUpdate=!0,l.open({template:"views/popup/addConsumer.html",showClose:!0,closeByDocument:!1,controller:"consumerAddController",className:"ngdialog-theme-default custom-width-800",scope:e})},e.gridApi.core.on.sortChanged(e,function(n,t){e.getPage&&(t.length>0?g.sort=t[0].sort.direction:g.sort=null,e.getPage(n.options.paginationCurrentPage,n.options.paginationPageSize,g.sort))}),n.pagination.on.paginationChanged(e,function(n,t){e.getPage&&e.getPage(n,t,g.sort)})}};var m,K;e.successFetchAll=function(e){i.setAllCustomers(e)},e.failedFetchAll=function(e){i.clearAllCustomers()},e.getPage=function(n,t,l){e.refreshGrid(),m=n,K=t,NProgress.start();var r={};r.limit=t,r.offset=(n-1)*t,KnurldSDK.consumer.get(r,function(n){i.debugLogs("KnurldSDK.consumer.get",r,n),e.success(n)},e.failed)},e.deleteConsumer=function(n){NProgress.start();var t={};t.consumerId=n.entity.id,KnurldSDK.consumer.del(t,function(n){i.debugLogs("KnurldSDK.consumer.del",t,n),e.deleteSuccess(n)},e.failed)},e.deleteSuccess=function(n){NProgress.done(),s.success("Consumer","Successfully deleted Consumer"),l.close(),t.go("consumer",{},{}),e.getPage(1,e.consumerGrid.paginationPageSize)},e.refreshGrid=function(){e.consumerGrid.data=[],e.$$phase||e.$apply()},e.formatResponse=function(e){var n=[];return null==e||angular.isUndefined(e)?n=e:angular.forEach(e,function(e,t){var l={};angular.forEach(e,function(e,n){if("href"==n)l.id=e.split("/").pop(),l.href=e;else if("createdTime"==n){var t=new Date(e),r=[(t.getMonth()+1).padLeft(),t.getDate().padLeft(),t.getFullYear()].join("/")+" "+[t.getHours().padLeft(),t.getMinutes().padLeft(),t.getSeconds().padLeft()].join(":");l[n]=r}else l[n]=e}),n.push(l)}),n},e.success=function(n){var t=e.formatResponse(n.items);e.consumerGrid.totalItems=n.total,NProgress.done(),e.consumerGrid.data=t,e.$apply()},e.failed=function(n){a.proccess(n,"App Model",t,s),e.$apply()},e.getPage(1,e.consumerGrid.paginationPageSize)}]),app.controller("callsController",["$scope","$state","ngDialog","words","toaster","store","errorHandlingService",function(e,n,t,l,r,s,o){e.$state=n;var a={sort:null};e.clearAll=function(){e.isUpdate=!1,e.gridApi.selection.clearSelectedRows()},e.deleteCall=function(){NProgress.start();var n={},t=s.getCallRow().entity.href.split("/");n.callId=t.pop(),KnurldSDK.call.del(n,e.deleteSuccess,e.failed)},e.deleteSuccess=function(e){NProgress.done(),r.success("Calls ","Successfully deleted Call "),t.close(),n.go("calls")},e.addCall=function(){e.clearAll(),s.setCallRow(null),t.open({template:"views/popup/addCall.html",showClose:!0,closeByDocument:!1,controller:"callAddController",className:"ngdialog-theme-default custom-width-800"})},e.callGrid={paginationPageSizes:[10,20,30],paginationPageSize:10,useExternalPagination:!0,useExternalSorting:!0,enableGridMenu:!0,enableColumnResizing:!0,enableRowSelection:!0,enableSelectAll:!0,multiSelect:!1,exporterAllDataFn:function(){return u(1,e.callGrid.totalItems,a.sort).then(function(){e.callGrid.useExternalPagination=!1,e.callGrid.useExternalSorting=!1,u=null})},onRegisterApi:function(n){e.gridApi=n,e.gridApi.core.on.sortChanged(e,function(e,n){u&&(n.length>0?a.sort=n[0].sort.direction:a.sort=null,u(e.options.paginationCurrentPage,e.options.paginationPageSize,a.sort))}),n.selection.on.rowSelectionChanged(e,function(n){s.setCallRow(n),n.isSelected?e.isUpdate=!0:e.isUpdate=!1}),n.pagination.on.paginationChanged(e,function(e,n){u&&u(e,n,a.sort)})}},e.updateCall=function(){t.open({template:"views/popup/addCall.html",showClose:!0,closeByDocument:!1,controller:"callAddController",className:"ngdialog-theme-default custom-width-800"})};var i,d,u=function(n,t,l){i=n,d=t,NProgress.start();var r={};r.limit=t,r.offset=(n-1)*t,KnurldSDK.call.get(r,e.success,e.failed)};e.success=function(n){e.callGrid.totalItems=n.total,e.callGrid.data=n.items,NProgress.done(),e.$apply()},e.failed=function(e){o.proccess(e,"App Model",n,r),console.log(e)},u(1,e.callGrid.paginationPageSize)}]),app.controller("analyticsController",["$scope","$state","ngDialog","words","toaster","store","errorHandlingService",function(e,n,t,l,r,s,o){e.analyseProgress=0,e.$state=n,e.analyseIntervalId,e.url="https://www.dropbox.com/s/hytfzzv3pm0evti/Canada_Pyramid_Dallas.wav?dl=1",e.file,e.analyse1=function(){NProgress.start();var n={};return n.audioUrl=e.url,angular.isUndefined(e.num_words)||(n.num_words=e.num_words1),""==e.url||angular.isUndefined(e.url)?(r.error("Knurld","Please select file"),void NProgress.done()):void KnurldSDK.analytics.url(n,e.analyseUploadSuccess,e.failed)},e.analyse2=function(){if(NProgress.start(),angular.isUndefined(e.file))return r.error("Knurld","Please select file"),void NProgress.done();var n={};n.fileData=e.file,angular.isUndefined(e.num_words)||(n.num_words=e.num_words2),KnurldSDK.analytics.file(n,e.analyseUploadSuccess,e.failed)},e.analyse3=function(){NProgress.start(),angular.isUndefined(e.num_words)||(n.num_words=e.num_words3);var n={};return n.fileData=e.recordedInput,angular.isUndefined(e.recordedInput)?(r.error("Knurld","File is not ready please record file"),void NProgress.done()):0!=e.analyseProgress?(r.error("Knurld","File analyse in progress, please wait..."),void NProgress.done()):(e.analyseProgress=1,void KnurldSDK.analytics.file(n,e.analyseUploadSuccess,e.failed))},e.analyse=function(){var n={};return n.fileData=e.recordedInput,angular.isUndefined(e.recordedInput)?(r.error("Knurld","File is not ready please record file"),void NProgress.done()):0!=e.analyseProgress?(r.error("Knurld","File analyse in progress, please wait..."),void NProgress.done()):(e.analyseProgress=1,angular.isUndefined(e.num_words)||(n.num_words=e.num_words),KnurldSDK.analytics.file(n,e.analyseUploadSuccess,e.failed),void 0)},e.uploadFile=function(n){e.file=n.target.files[0]},e.analyseUploadSuccess=function(n){var t={};t.isTimer=!0,t.interval=2e3,t.fileData=e.recordedInput,t.id=n.taskName,e.analyseIntervalId=KnurldSDK.analytics.get(t,e.analyseSuccess,e.failed)},e.failed=function(t){o.proccess(t,"analyse",n,r),e.$apply()},e.analyseSuccess=function(n){if("completed"==n.taskStatus){NProgress.done(),KnurldSDK.clearInterval(e.analyseIntervalId),e.analyseIntervalId="-1",e.analyseProgress=0;n.intervals;e.jsonVal=JSON.stringify(n.intervals),e.$apply()}}}]),app.directive("customOnChange",function(){return{restrict:"A",link:function(e,n,t){var l=e.$eval(t.customOnChange);n.bind("change",l)}}});